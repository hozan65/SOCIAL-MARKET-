<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Social Market • Marketplace</title>

  <!-- Senin global css'lerin (topbar/menu renkleri) -->
  <link rel="stylesheet" href="/assets/u.css" />
  <link rel="stylesheet" href="/assets/app.css" />

  <!-- Marketplace theme -->
  <link rel="stylesheet" href="./marketplace.css" />
</head>

<body>

<!-- ✅ HEADER YOK: Senin sistem zaten bunu ekliyor -->

<main class="mpWrap mpWrapTopbar">
  <div class="mpPageHead">
    <div>
      <h1 class="mpH1">Marketplace</h1>
      <p class="mpP">Buy boosts, services and packages using your coins.</p>
    </div>

    <div class="mpHeadActions">
      <button class="mpBtn" id="mpOpenAdd">+ Add Listing</button>
      <button class="mpBtn mpBtnPrimary" id="mpOpenCart">
        Cart <span class="mpBadge" id="mpCartCount">0</span>
      </button>
    </div>
  </div>

  <!-- FILTERS -->
  <section class="mpFilters">
    <div class="mpSearch">
      <input id="mpSearch" type="text" placeholder="Search listings (views, likes, subscribers, premium...)" />
    </div>

    <div class="mpRow">
      <select id="mpCategory" class="mpSelect">
        <option value="all">All categories</option>
        <option value="boost">Boost</option>
        <option value="service">Service</option>
        <option value="digital">Digital</option>
        <option value="membership">Membership</option>
      </select>

      <select id="mpSort" class="mpSelect">
        <option value="new">Newest</option>
        <option value="price_asc">Price (Low → High)</option>
        <option value="price_desc">Price (High → Low)</option>
        <option value="rating_desc">Rating</option>
      </select>

      <div class="mpToggle">
        <input id="mpOnlyInStock" type="checkbox" />
        <label for="mpOnlyInStock">In stock only</label>
      </div>
    </div>
  </section>

  <!-- LIST -->
  <section class="mpGrid" id="mpGrid"></section>

  <footer class="mpFooter">
    <div>© <span id="mpYear"></span> Social Market</div>
    <div class="mpHint">LocalStorage version (we can connect Supabase orders later).</div>
  </footer>
</main>

<!-- ADD LISTING MODAL -->
<div class="mpModal" id="mpAddModal" aria-hidden="true">
  <div class="mpModalCard">
    <div class="mpModalHead">
      <div class="mpModalTitle">Add Listing</div>
      <button class="mpIconBtn" id="mpCloseAdd" title="Close">✕</button>
    </div>

    <div class="mpForm">
      <div class="mpField">
        <label>Title</label>
        <input id="mpAddName" type="text" placeholder="e.g. 10K Views Boost" />
      </div>

      <div class="mpField">
        <label>Category</label>
        <select id="mpAddCategory">
          <option value="boost">Boost</option>
          <option value="service">Service</option>
          <option value="digital">Digital</option>
          <option value="membership">Membership</option>
        </select>
      </div>

      <div class="mpField">
        <label>Price (Coins)</label>
        <input id="mpAddPrice" type="number" min="0" step="1" placeholder="e.g. 250" />
      </div>

      <div class="mpField">
        <label>Stock</label>
        <input id="mpAddStock" type="number" min="0" step="1" placeholder="e.g. 10" />
      </div>

      <div class="mpField mpFieldFull">
        <label>Description</label>
        <textarea id="mpAddDesc" rows="3" placeholder="What’s included? Delivery time? Notes..."></textarea>
      </div>

      <div class="mpRowEnd">
        <button class="mpBtn" id="mpSeedDemo">Load Demo Listings</button>
        <button class="mpBtn mpBtnPrimary" id="mpAddSave">Save</button>
      </div>

      <div class="mpNote" id="mpAddNote"></div>
    </div>
  </div>
</div>

<!-- CART DRAWER -->
<div class="mpDrawer" id="mpCartDrawer" aria-hidden="true">
  <div class="mpDrawerCard">
    <div class="mpDrawerHead">
      <div class="mpDrawerTitle">Cart</div>
      <button class="mpIconBtn" id="mpCloseCart" title="Close">✕</button>
    </div>

    <div class="mpCartList" id="mpCartList"></div>

    <div class="mpCartFoot">
      <div class="mpTotalRow">
        <span>Total</span>
        <strong><span id="mpCartTotal">0</span> coins</strong>
      </div>
      <button class="mpBtn mpBtnPrimary mpBtnFull" id="mpCheckout">Checkout</button>
      <div class="mpSmall" id="mpCheckoutNote"></div>
    </div>
  </div>
</div>

<script>
  (async () => {
    const host = document.getElementById("siteTopbar");
    if (!host) return;

    const res = await fetch("/partials/topbar.html", { cache: "no-store" });
    host.innerHTML = await res.text();

    // mobile menu toggle (minimal)
    const btn = document.getElementById("hamburgerBtn");
    const menu = document.getElementById("mobileMenu");
    const back = document.getElementById("menuBackdrop");

    function openMenu(){
      btn?.setAttribute("aria-expanded","true");
      menu?.setAttribute("aria-hidden","false");
      menu?.classList.add("isOpen");
      back?.classList.add("isOpen");
    }
    function closeMenu(){
      btn?.setAttribute("aria-expanded","false");
      menu?.setAttribute("aria-hidden","true");
      menu?.classList.remove("isOpen");
      back?.classList.remove("isOpen");
    }
    btn?.addEventListener("click", () => {
      const isOpen = menu?.classList.contains("isOpen");
      isOpen ? closeMenu() : openMenu();
    });
    back?.addEventListener("click", closeMenu);
  })();
</script>

<script src="/assets1/header.js"></script>
<script src="./marketplace.js"></script>
</body>
</html>
